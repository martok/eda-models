Version 4
SHEET 1 1044 680
WIRE -304 -208 -464 -208
WIRE -288 -208 -304 -208
WIRE -192 -208 -208 -208
WIRE 128 -208 -192 -208
WIRE 336 -208 208 -208
WIRE 192 -144 192 -160
WIRE 192 -48 192 -64
WIRE 16 64 -16 64
WIRE 144 64 144 -160
WIRE 144 64 96 64
WIRE -192 128 -192 -208
WIRE -176 128 -192 128
WIRE -16 128 -16 64
WIRE -16 128 -96 128
WIRE 32 128 -16 128
WIRE 192 128 80 128
WIRE 288 128 272 128
WIRE 80 160 80 128
WIRE 32 176 32 128
WIRE 48 176 32 176
WIRE 144 192 144 64
WIRE 144 192 112 192
WIRE 288 192 288 128
WIRE 320 192 288 192
WIRE 48 208 32 208
WIRE -304 256 -304 -208
WIRE -176 256 -304 256
WIRE -16 256 -96 256
WIRE 32 256 32 208
WIRE 32 256 -16 256
WIRE 80 256 80 224
WIRE 192 256 80 256
WIRE 288 256 288 192
WIRE 288 256 272 256
WIRE -16 272 -16 256
WIRE -16 368 -16 352
FLAG -464 -208 VSS
IOPIN -464 -208 In
FLAG 336 -208 VDD
IOPIN 336 -208 Out
FLAG 192 -48 VSS
IOPIN 192 -48 In
FLAG -16 368 VSS
IOPIN -16 368 In
FLAG 320 192 VSS
IOPIN 320 192 In
SYMBOL sw 112 -208 R270
SYMATTR InstName S1
SYMBOL res -304 -192 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value {rshunt}
SYMBOL OpAmps\\UniversalOpamp2 80 192 R0
SYMATTR InstName U1
SYMATTR Value2 Avol=1meg GBW=1meg Slew=1/{slewtime}
SYMBOL voltage 288 256 R90
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 1
SYMBOL voltage 176 128 R270
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 1
SYMBOL voltage 192 -160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 1
SYMBOL res -80 112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value {rsensel}
SYMBOL res -80 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {rsensel}
SYMBOL res 0 368 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R5
SYMATTR Value {rsenseh}
SYMBOL res 0 80 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value {rsenseh}
TEXT -312 -440 Left 2 !.param ilim=1meg rshunt=1m thr=0.99 slewtime=100u
TEXT -312 -296 Left 2 !.model sw SW(ron=1u roff=10gig vt={vthr/2} vh={-vthr/2})
TEXT -312 -392 Left 2 !.param vthr=limit(1m,1-1m,1-thr)\n.param rsenseh=1meg\n.param rsensel=rsenseh*(rshunt*ilim)
